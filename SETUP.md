# Setup Guide

## Prerequisites

1. Python 3.8 or higher
2. Elasticsearch 8.x installed and running locally
3. Access to embedding API: http://test.2brain.cn:9800/v1/emb
4. Access to re-ranker API: http://test.2brain.cn:2260/rerank

## Step-by-Step Setup

### 1. Install Python Dependencies

```bash
pip install -r requirements.txt
```

### 2. Set Up Elasticsearch

1. Download and install Elasticsearch from [elastic.co](https://www.elastic.co/downloads/elasticsearch)
2. Run the Elasticsearch quickstart script (if available) or start Elasticsearch manually
3. The quickstart script will generate a `.env` file with credentials
4. Locate the `.env` file in your Elasticsearch directory

### 3. Extract Elasticsearch Credentials

From the `.env` file generated by Elasticsearch, extract:
- `ELASTICSEARCH_PASSWORD` - The password for the `elastic` user
- `ELASTICSEARCH_API_KEY` - The API key for authentication

### 4. Create Your .env File

Create a `.env` file in the project root directory:

```bash
# Copy the template below and fill in your values
```

Template:
```
ELASTICSEARCH_HOST=https://localhost:9200
ELASTICSEARCH_USER=elastic
ELASTICSEARCH_PASSWORD=your_password_from_elasticsearch_env
ELASTICSEARCH_API_KEY=your_api_key_from_elasticsearch_env
ELASTICSEARCH_VERIFY_CERTS=false

EMBEDDING_URL=your_embedding_url
RERANK_URL=your_rerank_url

# Optional: LLM API for answer generation
LLM_API_URL=
LLM_MODEL=gpt-3.5-turbo
```

### 5. Test the Connection

```bash
python main.py test
```

If successful, you should see:
```
Connected to Elasticsearch: 8.x.x
âœ“ Connection successful!
```

### 6. Process Your First PDF

```bash
python main.py process --pdf path/to/your/document.pdf
```

### 7. Query the System

```bash
python main.py query --query "Your question here"
```

## Troubleshooting

### Elasticsearch Connection Issues

1. **Verify Elasticsearch is running:**
   ```bash
   curl -k https://localhost:9200
   ```
   Or check the Elasticsearch service status

2. **Check credentials:**
   - Verify `ELASTICSEARCH_PASSWORD` and `ELASTICSEARCH_API_KEY` are correct
   - Make sure you're using the values from the Elasticsearch `.env` file

3. **SSL Certificate Issues:**
   - Set `ELASTICSEARCH_VERIFY_CERTS=false` in your `.env` file for local development

### API Connection Issues

1. **Embedding API:**
   - Verify the URL is accessible: `curl your_embedding_url`
   - Check network connectivity
   - The system will use zero vectors as fallback if API fails

2. **Re-ranker API:**
   - Verify the URL is accessible: `curl your_rerank_url`
   - If API fails, the system automatically falls back to RRF

### Common Errors

1. **ModuleNotFoundError:**
   - Run `pip install -r requirements.txt` again
   - Make sure you're using the correct Python environment

2. **Index Already Exists:**
   - This is normal if you've run the system before
   - To delete the index and start fresh, you can modify the code to call `indexer.delete_index()` before creating

3. **PDF Processing Errors:**
   - Make sure the PDF file path is correct
   - Check that the PDF file is not corrupted
   - Try a different PDF file to test

## Next Steps

- Process multiple PDF files
- Experiment with different chunk sizes
- Adjust retrieval and re-ranking parameters in `config.py`
- Configure an LLM API for better answer generation

